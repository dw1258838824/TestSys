package com.testsys.utils;

import java.util.Map;

import org.springframework.beans.factory.annotation.Value;
import org.springframework.stereotype.Component;

import com.alibaba.fastjson.JSONObject;
import com.google.common.collect.Maps;
import com.ruoyi.common.utils.HttpUtils;
import com.ruoyi.common.utils.Md5Utils;

@Component
public class ClassInUtils {
	
	public static String SID;
	public static String SECRET;
	public static String URL;

	@Value("${classIn.SID}")
	public static void setSID(String sID) {
		SID = sID;
	}

	@Value("${classIn.SECRET}")
	public static void setSECRET(String sECRET) {
		SECRET = sECRET;
	}

	@Value("${classIn.URL}")
	public static void setURL(String uRL) {
		URL = uRL;
	}
	
	/**
	 * 调用classIn接口
	 * @param action register：注册  addCourse：添加课程    addCourseClass：添加课节
	 * @param params post提交参数
	 * @return
	 */
	public static String httpRequest(String action,Map<String, String> params) {
		String now = (System.currentTimeMillis()/1000)+"";
		params.put("SID", SID);
		params.put("safeKey", Md5Utils.toMD5(new StringBuffer(now).append(SECRET).toString()));
		params.put("timeStamp", now);
		return HttpUtils.URLPost(URL + action, params, "UTF-8");
	}
	public static void main(String[] args) {
		Map<String, String> params = Maps.newHashMap();
		params.put("SID", "23071866");
		params.put("safeKey", "692631e01260a89f0fda23cedbce1534");
		params.put("timeStamp", "1593586224");
		params.put("telephone", "18038081947");
		params.put("nickname", "大佬啊");
		params.put("password", "123456");
		params.put("addToSchoolMember", "2");
		String json=  HttpUtils.URLPost("https://api.eeo.cn/partner/api/course.api.php?action=register", params, "UTF-8");
		JSONObject obj = JSONObject.parseObject(json);
    	Integer errno = obj.getJSONObject("error_info").getInteger("errno");
    	if(null!=errno && (errno==1 || errno==135)) {//注册成功或者已存在
    		Long uid = obj.getLong("data");//添加老师获得老师uid
    		System.out.println(uid);
    	}else {
    		System.out.println("错误");
    	}
	}
}
