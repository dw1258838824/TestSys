<!DOCTYPE html>
<html lang="zh" xmlns:th="http://www.thymeleaf.org" >
<head>
    <th:block th:include="include :: header('新增试卷管理')" />
</head>
<body class="white-bg">
    <div class="wrapper wrapper-content animated fadeInRight ibox-content">
        <form class="form-horizontal m" id="form-paper-add">
            <div class="form-group">    
                <label class="col-sm-3 control-label is-required">试卷名称：</label>
                <div class="col-sm-8">
                    <input name="paperName" class="form-control" type="text" required>
                </div>
            </div>
            <div class="form-group">    
                <label class="col-sm-3 control-label is-required">试卷类型：</label>
                <div class="col-sm-8">
                    <select name="paperType" class="form-control m-b" th:with="type=${@dict.getType('sys_paper_type')}" required>
                        <option th:each="dict : ${type}" th:text="${dict.dictLabel}" th:value="${dict.dictValue}"></option>
                    </select>
                </div>
            </div>
            <div class="form-group">    
                <label class="col-sm-3 control-label">等级：</label>
                <div class="col-sm-8">
                    <select name="level" class="form-control m-b">
                    </select>
                </div>
            </div>
            <div class="form-group">    
                <label class="col-sm-3 control-label is-required">科目：</label>
                <div class="col-sm-8">
                    <select name="subjectId" class="form-control m-b" required>
                    </select>
                </div>
            </div>
            
            <div class="form-group">    
                <label class="col-sm-3 control-label is-required">选择题目：</label>
                <div class="col-sm-8">
                    <table id="bootstrap-table" class=" table-bordered " >
	                    <thead>
		                    <tr align="center">
			                    <th> 题目类型</th>
			                    <th> 数量</th>
			                    <th> 每题分数</th>
		                    </tr>
	                    </thead>
	                    <tbody id="questionTypeBody">
	                   	</tbody>
                   	</table>
                </div>
            </div>
            
            <div class="form-group">    
                <label class="col-sm-3 control-label is-required">总分：</label>
                <div class="col-sm-8">
                    <input name="allScore" class="form-control" type="number" required readOnly>
                </div>
            </div>
            <div class="form-group">    
                <label class="col-sm-3 control-label is-required">及格分数：</label>
                <div class="col-sm-8">
                    <input name="passScore" class="form-control" type="number" value="60" required>
                </div>
            </div>
           
            <div class="form-group">    
                <label class="col-sm-3 control-label is-required">判卷模式：</label>
                <div class="col-sm-8">
                    <select name="judgeMode" class="form-control m-b" th:with="type=${@dict.getType('sys_judge_mode')}" required>
                        <option th:each="dict : ${type}" th:text="${dict.dictLabel}" th:value="${dict.dictValue}"></option>
                    </select>
                </div>
            </div>
            <div class="form-group hide">    
                <label class="col-sm-3 control-label">考点模块时段json：</label>
                <div class="col-sm-8">
                    <input name="modularTimeJson" class="form-control" type="text">
                </div>
            </div>
        </form>
    </div>
    <th:block th:include="include :: footer" />
    <script type="text/javascript">
        var prefix = ctx + "system/paper"
        $("#form-paper-add").validate({
            focusCleanup: true
        });

        function submitHandler() {
            if ($.validate.form()) {
                $.operate.save(prefix + "/add", $('#form-paper-add').serialize());
            }
        }
        function changeScore(){
        	var i = 0;
        	var allScore = 0.00;
        	$(".questionCount").each(function(){
        		var count = parseInt($(this).val());
           		var score = parseFloat($($(".questionScore")[i]).val());
           		if(!count){
           			$(this).val(0);
           			count = 0;
           		}
           		if(!score){
           			$($(".questionScore")[i]).val(0);
           			score = 0;
           		}
           		allScore += count*score;
           		i++;
        	});
          	$("input[name='allScore']").val(allScore);
        }
    	function initTypeBody(){
    		$.ajax({
    	        type: "POST",
    	        url: ctx + "system/type/getlist",
    	        success: function(result){
    	            if(result.length > 0){
    	            	 var allScore = 0.0;
    		           	 for(var i=0 ; i<result.length ; i++){
    		           		 var typeId = result[i].questionTypeId;
    		           		 var typeName =  result[i].questionTypeName;
    		           		 var count =  result[i].defaultCount;
    		           		 var score =  result[i].defaultScore;
    		           		 var typeMode =  result[i].typeMode;
    		           		 var rdstr = "";
    		           		 if(typeMode != "1"){
    		           			rdstr = "readOnly";
    		           		 }
    		           		 var htmlStr = '<tr>'+
							                   '<td>  <input type="text"  class="" value="'+typeName+'" lang="'+typeId+'"   placeholder="题目类型" readOnly /> </td>'+
							                   '<td>  <input type="number" name="questionCount'+typeId+'" class="questionCount" onblur="changeScore()" placeholder="题目数量" value="'+count+'" '+rdstr+' /> </td>'+
							                   '<td>  <input type="number" name="questionScore'+typeId+'" class="questionScore" onblur="changeScore()" placeholder="每题分数" value="'+score+'"/> </td>'+
						                   '</tr>';
    		           		 $("#questionTypeBody").append(htmlStr);
    		           		allScore += parseInt(count)*parseFloat(score);
    		           	 }
    		           	 $("input[name='allScore']").val(allScore);
    	            }
    	        }
    	    });
    	}
    	initTypeBody();
    	initLevelList("level","");
    	initSubjectList("subjectId","");
    </script>
</body>
</html>